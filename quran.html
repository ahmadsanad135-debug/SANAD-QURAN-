<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مصحف سند - القراءة والاستماع</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary-color: #0f5132; --accent-color: #bfa15f; }
        body { font-family: 'Cairo', sans-serif; background-color: #f8f9fa; margin: 0; padding-bottom: 20px; }
        
        header { background: var(--primary-color); color: white; padding: 1rem; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; }
        .header-title { font-family: 'Amiri', serif; font-size: 1.5rem; margin: 0 auto; }
        .back-btn { background: rgba(255,255,255,0.2); color: white; text-decoration: none; padding: 5px 15px; border-radius: 5px; font-size: 0.9rem; }

        .container { max-width: 800px; margin: 0 auto; padding: 15px; }

        .quran-display { background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; min-height: 400px; text-align: center; line-height: 2.8; }
        .ayah { font-family: 'Amiri', serif; font-size: 2rem; color: #222; word-wrap: break-word; }
        .ayah-num { color: var(--primary-color); font-size: 1.3rem; margin: 0 8px; font-family: 'Cairo', sans-serif; border: 1px solid #ddd; border-radius: 50%; padding: 0 8px; }

        .player-section { background: white; padding: 1.5rem; border-radius: 15px; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); position: sticky; bottom: 10px; z-index: 999; }
        .reciter-select { width: 100%; padding: 12px; border-radius: 10px; border: 2px solid #eee; font-family: 'Cairo', sans-serif; margin-bottom: 15px; text-align: right; font-size: 1rem; cursor: pointer; }
        
        audio { width: 100%; height: 45px; margin-bottom: 15px; }

        .controls-container { display: flex; justify-content: center; gap: 50px; align-items: center; padding-top: 10px; border-top: 1px solid #eee; }
        .control-btn { background: none; border: none; font-size: 2rem; color: #ccc; cursor: pointer; transition: 0.3s; }
        .control-btn.active { color: var(--accent-color); transform: scale(1.1); }
        .control-btn:hover { color: var(--primary-color); }
    </style>
</head>
<body>

    <header>
        <div style="width: 60px;"></div>
        <div id="top-surah-name" class="header-title">...</div>
        <a href="index.html" class="back-btn">العودة</a>
    </header>

    <div class="container">
        <div id="quran-text" class="quran-display">
            <p>جاري تحميل نص السورة...</p>
        </div>

        <div class="player-section">
            <select id="reciter-list" class="reciter-select">
                <option value="https://server8.mp3quran.net/afs/">مشاري العفاسي</option>
                <option value="https://server12.mp3quran.net/maher/">ماهر المعيقلي</option>
                <option value="https://server14.mp3quran.net/islam/">إسلام صبحي</option>
                <option value="https://server7.mp3quran.net/sds/">عبد الرحمن السديس</option>
                <option value="https://server7.mp3quran.net/shur/">سعود الشريم</option>
                <option value="https://server13.mp3quran.net/basit_mojawad/">عبد الباسط عبد الصمد (مجود)</option>
                <option value="https://server13.mp3quran.net/husr/">محمود خليل الحصري</option>
                <option value="https://server10.mp3quran.net/minsh/">محمد صديق المنشاوي</option>
                <option value="https://server11.mp3quran.net/yasser/">ياسر الدوسري</option>
                <option value="https://server10.mp3quran.net/ajm/">أحمد العجمي</option>
                <option value="https://server8.mp3quran.net/frs_a/">فارس عباد</option>
            </select>

            <audio id="main-player" controls>
                <source id="audio-src" src="" type="audio/mpeg">
            </audio>

            <div class="controls-container">
                <button id="next-btn" class="control-btn" title="السورة التالية"><i class="fas fa-step-forward"></i></button>
                <button id="loop-btn" class="control-btn" title="تكرار السورة الحالية"><i class="fas fa-sync-alt"></i></button>
            </div>
        </div>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const surahNum = params.get('surah') || '1';
        const audio = document.getElementById('main-player');
        const reciterSelect = document.getElementById('reciter-list');
        let isLoop = false;

        async function loadContent() {
            try {
                const res = await fetch(`https://api.alquran.cloud/v1/surah/${surahNum}`);
                const data = await res.json();
                const surah = data.data;

                document.getElementById('top-surah-name').textContent = `سورة ${surah.name}`;
                
                const textDiv = document.getElementById('quran-text');
                textDiv.innerHTML = surah.ayahs.map(a => `
                    <span class="ayah">${a.text} <span class="ayah-num">${a.numberInSurah}</span></span>
                `).join(' ');

                updateAudio();
            } catch (e) {
                document.getElementById('quran-text').textContent = "خطأ في تحميل نص السورة.";
            }
        }

        function updateAudio() {
            const server = reciterSelect.value;
            const audioId = surahNum.padStart(3, '0');
            document.getElementById('audio-src').src = `${server}${audioId}.mp3`;
            audio.load();
        }

        reciterSelect.onchange = updateAudio;

        // أزرار التحكم الجديدة
        const loopBtn = document.getElementById('loop-btn');
        const nextBtn = document.getElementById('next-btn');

        loopBtn.onclick = () => {
            isLoop = !isLoop;
            loopBtn.classList.toggle('active', isLoop);
        };

        nextBtn.onclick = () => {
            const nextS = parseInt(surahNum) + 1;
            if (nextS <= 114) {
                window.location.href = `quran.html?surah=${nextS}`;
            } else {
                alert("وصلت إلى نهاية المصحف الشريف.");
            }
        };

        // التكرار والتقديم التلقائي
        audio.onended = () => {
            if (isLoop) {
                audio.currentTime = 0;
                audio.play();
            } else {
                nextBtn.click(); // تشغيل السورة التالية تلقائياً عند انتهاء الحالية
            }
        };

        loadContent();
    </script>
</body>
</html>
